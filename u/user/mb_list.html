<title>模板列表</title>
<div class="layadmin-pagetabs">
    <strong class="on">
        <a href="">个人中心</a>
        <i class="iconfont iconico_leftnav_down_sel1"></i>
        <a href="">模板管理</a>
        <i class="iconfont iconico_leftnav_down_sel1"></i>
        <a href="javascript:;">模板列表</a>
    </strong>
</div>

<div class="layui-fluid layui-card-bodyx">
    <div class="layui-card">
        <div class="layui-tab-content layui-card">
            <div class="layui-tab" lay-filter="pl" lay-allowclose="true">
                <ul class="layui-tab-title">
                    <li class="layui-this"><a>模板列表</a></li>
                </ul>
            </div>
        </div>

        <div class="layui-card-body">
            <blockquote class="layui-elem-quote shuoming" style="margin: -10px 0 24px;"><i
                    class="iconfont icontixing"></i>关于设置默认模板的说明：每个帐户只能设置一个默认模板，设置前，模板必须先通过审核。</blockquote>

            <div class="layui-btn-container layui-search-table borderG layui-clear layui-inline-fl">
                <form class="layui-form search-order-form" action="">
                    <div class="layui-inline search-sorts-wrap">
                        <div class="search-sorts-inline">
                            <input name="sqr" placeholder="请输入申请人" class="layui-input search">
                        </div>
                    </div>

                    <div class="layui-inline">
                        <button class="layui-btn" lay-submit lay-filter="search-brand">搜索</button>
                    </div>
                </form>
            </div>

            <table class="layui-hide" id="order-list-tabel" lay-filter="order-list-tabel"></table>
        </div>
    </div>
</div>


<!--操作模板-->
<script id="toolTpl" type="text/html">
    <div class="tool-btns-wrap">
        <button class="layui-btn layui-btn-primary" lay-event="del">删除</button>
        <button class="layui-btn" lay-event="edit">编辑</button>
    </div>
</script>

<!-- mock数据接口 -->
<script src="https://cdn.bootcdn.net/ajax/libs/Mock.js/1.0.1-beta3/mock-min.js"></script>
<script>
    layui.use(['table', 'form', 'laytpl', 'x'], function () {
        var x = layui.x;
        var table = layui.table,
            $ = layui.jquery,
            form = layui.form,
            laytpl = layui.laytpl;


        //mockmock数据-订单列表
        var Random = Mock.Random;
        Mock.mock('http:localhost:8001/order/p_order_list?page=1&limit=10&csrf_token=111', {
            'count': 100,
            'data|10': [{
                'id|+1': 1,
                'bmmc': '@ctitle(5)',
                'sqr': '@ctitle(8)',
                'bmbh': '@string("upper", 2)' + '@integer(100)',
                'lx|1-2': 1,
                'lx_msg|1': ['企业', '个人'],
                'zt|0-2': 0,
                'zt_msg|1': ['等待审核', '审核通过', '审核未通过'],
                'area': Random.city(),
                'mr|0-1': 0
            }],
            'code': 0,
            'msg': '获取成功'
        });
        Mock.mock('http:localhost:8001/user_zh/del_xiaoxi', {
            'code': -1,
            'msg': '删除成功'
        });

        var objList = {
            'lx': {
                title: '类型',
                param: 'lx'
            },
            'zt': {
                title: '状态',
                param: 'zt'
            }
        }
        var pageList = [{
            id: 'lx',
            title: '类型',
            param: 'lx',
            list: [{
                '企业': 1
            }, {
                '个人': 2
            }]
        }, {
            id: 'zt',
            title: '状态',
            param: 'zt',
            list: [{
                '等待审核': 0
            }, {
                '审核通过': 1
            }, {
                '审核未通过': 2
            }]
        }];

        layui.x.sortSelects(pageList)

        //数据表格渲染
        table.render({
            elem: '#order-list-tabel',
            url: 'http:localhost:8001/order/p_order_list',
            cols: [
                [{
                    field: 'bmbh',
                    title: '模板编号',
                    align: 'center'
                }, {
                    field: 'lx_msg',
                    width: 120,
                    title: '<span class=\'sx lx\' data-id=\'lx\'>类型</span>'
                }, {
                    field: 'bmmc',
                    title: '模板名称',
                    align: 'center'
                }, {
                    field: 'sqr',
                    title: '申请人',
                    align: 'center'
                }, {
                    field: 'area',
                    title: '国家/地区',
                    align: 'center'
                }, {
                    field: 'zt_msg',
                    width: 160,
                    title: '<span class=\'sx zt\' data-id=\'zt\'>状态</span>',
                    align: 'center'
                }, {
                    field: 'mr',
                    title: '默认',
                    width: 80,
                    align: 'center',
                    templet: function (d) {
                        return d.mr == 0 ? '否' : '是';
                    }
                }, {
                    width: 240,
                    title: '操作',
                    toolbar: '#toolTpl',
                    align: 'center'
                }]
            ],
            page: true,
            done: function (res) {
                console.log(res)
            }
        });

        $(document).off('click', '.dropdown .layui-nav-child dd');
        var sendData = {};
        $(document).on('click', ".dropdown .layui-nav-child dd", function () {
            var $id = $(this).parents(".dropdown").attr("id");
            var $val = $(this).attr('data-value');
            var $txt = $(this).text();
            objList[$id].title = $txt;
            if (Object.keys(sendData).length == 0) {
                for (var i in objList) {
                    sendData[objList[i].param] = '';
                }
            }
            sendData[objList[$id].param] = $val;
            table.reload('order-list-tabel', {
                where: sendData
            });
        })

        //搜索
        form.on('submit(search-brand)', function (data) {
            var data = data.field;
            table.reload('order-list-tabel', {
                where: {
                    data
                },
                page: {
                    curr: 1
                }
            });
            return false;
        });

        //监听行工具事件
        table.on('tool(order-list-tabel)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') { //删除
                layer.confirm('<font color=red>确定删除该条模板吗</font>', {
                    title: "温馨提示",
                    icon: 3
                }, function (index) {
                    layui.admin.req({
                        type: 'POST',
                        url: 'http:localhost:8001/user_zh/del_xiaoxi',
                        data: {
                            ids: data.id
                        },
                        success: function (res) {
                            layer.close(index);
                            if (res.code == 1) {
                                obj.del();
                                layer.msg(res.msg, {
                                    time: 1000
                                });
                            } else if (res.code == -1) {
                                layer.alert(res.msg, layui.x.layset())
                            }
                        }
                    });
                    layer.close(index);
                });
            } else if (obj.event === 'edit') { //编辑
                layer.msg('编辑')
            }
        });

    })
</script>